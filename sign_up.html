<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="utf-8" />
<meta name="viewport"
content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-4bw+/aepP/YC94hEpVNVgiZdgIC5+VKNBQNGCHeKRQN+PtmoHDEXuppvnDJzQIu9" crossorigin="anonymous">
<link href="sign_up.css" rel="stylesheet" />
<title>Sign up page</title>


<script src="Auth.js"></script>
<script src="sign_up.js"></script>

<div>
  <header class="home-container">
    <div class="sign-up-container">
      <script src="Stars.js"></script>
      <header class="sign-up-header">
        <div class="sign-up-container1">
          <img alt="image" src="snapedit_1695414033775.png" class="sign-up-image"/>
        </div>
        <div class="sign-up-container2">
            <button name="log in" type="button" onclick="window.location.href='login_new.html';" class="transparent-button">
              <span class="sign-up-text">Log in</span></button>
          <button name="log in" type="button" onclick="window.location.href='sign_up.html';" class="transparent-button2">
            <span class="sign-up-text1">Sign up</span></button>
        </div>
      </header>

      <div class="sign-up-container3">
        <span class="sign-up-login-into-secura">Sign up to Secura</span>
        <body>
          <div id="authForm">
            <form action="#"  >
              <input type="text" name="firstname" id="fname" placeholder="Type your first name" autofocus class="sign-up-input " required/><br>
              <input type="text" name="lastname" id ="lname" placeholder="Type your last name" autofocus class="sign-up-input4" required/><br>
              <input type="email" name="email" id="email" placeholder="Type your email" autofocus class="sign-up-input1" required/><br>
              <input type="text" name="pasw" id="p1" placeholder="Type your password" autofocus class="sign-up-input2 " required/><br>
              <input type="text" name="pasw1" id="p2" placeholder="Confirm your password" autofocus class="sign-up-input3" required/><br>

              <span class="sign-up-textfirst-name">first Name</span>
              <span class="sign-up-textpassword">Last Name</span>
              <span class="sign-up-textpassword1">Password</span>
              <span class="sign-up-textpassword2">Confirm Password</span>
              <span class="sign-up-textpassword3">email</span>
              <button class="btn" type = "submit" id ="signUpButton" >Sign up</button>
            </form>
          </div>
          <script type="module">
            // Import the functions you need from the SDKs you need
            import { initializeApp } from "https://www.gstatic.com/firebasejs/10.5.0/firebase-app.js";
            import {
              getAuth,
              createUserWithEmailAndPassword,
              signInWithEmailAndPassword,
              onAuthStateChanged,
              signOut
            } from "https://www.gstatic.com/firebasejs/10.5.0/firebase-auth.js";
            // TODO: Add SDKs for Firebase products that you want to use
            // https://firebase.google.com/docs/web/setup#available-libraries
          
            // Your web app's Firebase configuration

            function check() {
                let p1 = document.getElementById("p1");
                let p2 = document.getElementById("p2");
                if (p1.value != p2.value) {
                  p2.setCustomValidity("Пароли не совпадают");
                  return false; 
                } else {
                  p2.setCustomValidity('');
                  return true;
                }
              }
              

              function CheckPassword() 
            { 
              let p1 = document.getElementById("p1");  
              let pasw = /(?=^.{8,}$)((?=.*\d)|(?=.*\W+))(?![.\n])(?=.*[A-Z])(?=.*[a-z]).*$/;
              if(p1.value.match(pasw)) { 
                p1.setCustomValidity('');
                return true;
                
              }
              else { 
                p1.setCustomValidity("Пароль должен содержать как минимум одну цифру, одну заглавную и одну строчную букву и быть длиной не менее 8 символов");
                return false;
              }
          }


            const firebaseConfig = {
              apiKey: "AIzaSyAwobDIPvOsRDTFnbSZB8Ib4kxXNeE5BYw",
              authDomain: "auth-11f95.firebaseapp.com",
              projectId: "auth-11f95",
              storageBucket: "auth-11f95.appspot.com",
              messagingSenderId: "554428377159",
              appId: "1:554428377159:web:a0839f04f79899911a6962"
            };
          
            // Initialize Firebase
            const app = initializeApp(firebaseConfig);
            const auth = getAuth(app);

            const userEmail = document.querySelector("#email");
            const userPassword = document.querySelector("#p1");
            const authForm = document.querySelector("#authForm");
            const signUpButton = document.querySelector("#signUpButton");

            const userSignUp = async() => {
              const signUpEmail = userEmail.value;
              const signUpPassword = userPassword.value;
              createUserWithEmailAndPassword(auth, signUpEmail, signUpPassword)
              .then((userCredential) => {
                  const user = userCredential.user;
                  console.log(user);
                  window.location.href = "login_new.html"
              })
              .catch((error) => {
                  const errorCode = error.code;
                  const errorMessage = error.message;
                  console.log(errorCode + errorMessage)
              })
            }
            signUpButton.addEventListener('click', () => {   
              check(); 
              CheckPassword();
              userSignUp();
              })
          </script>

        </body>
      </div>
    </div>
  </header>
</div>
  
